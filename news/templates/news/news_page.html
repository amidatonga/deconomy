{% extends 'news/base.html' %}

{% load social_share %}
{% block content %}
      <div class="post-page">
        <div class="post-author-date">
          <div class="post-author">
            <p>By {{ object.author }}</p>
          </div>
          <div class="post-date">
            {% if not object.published_date %}
              <p>Draft created: <b>{{ object.created_date }}</b></p>
            {% else %}
              <p><b>{{ object.published_date }}</b></p>
            {% endif %}
          </div>

        </div>
        <div class="post-title">
          <h1>{{ object.title }}</h1>
        </div>
       <!-- <img src="{{ object.author.profile.img.url }}" alt="{{ object.author }}" class="mr-2 rounded avatar-img" style="width: 64px; height: 64px;"> -->
       <p>{{ object.text|safe }}</p>
       <p>{{ object.created_date }}</p>
        {% if object.category %}
            <p>Category: <a href="{% url 'category_news' slug=object.category.slug %}">{{ object.category }}</a></p>
        {% endif %}
        <p>Views: {{ post.views }}</p>
        {% for post_tag in post.tags.all %}
          <a href="{% url 'tag_news' post_tag.slug %}" class="badge badge-pill badge-light">{{ post_tag.name }}</a>
        {% endfor %}
        <p>Поделиться:</p>
        {% post_to_facebook object.get_absolute_url "Post to Facebook!" %}
        {% post_to_twitter "New Post: {{object.title}}. Check it out!" object.get_absolute_urll "Post to Twitter" %}
        {% post_to_gplus object.get_absolute_url "Post to Google+!" %}
        {% post_to_linkedin object.title object.get_absolute_url "Post to LinkedIn" %}
        {% send_email object.title "New Post: {{object.title}}. Check it out!" object.get_absolute_url "Share via email" %}
        {% post_to_reddit "New Post: {{object.title}}" object.get_absolute_url %}
        <div class="telegram-this">
          <a href="https://telegram.me/share/url?url={{ page_absolute_url }}" target="_blank">Share via Telegram</a>
        </div>
        {% if object.author == user %}
        <a class="button" href="{% url 'edit_post' post.slug %}">Edit</a>
        <a href="{% url 'delete_post' post.slug %}">Delete</a>
        {% endif %}
        <br><br>
        <p>All articles by: <a href="{% url 'user_news' object.author %}">{{ object.author }}</a></p>
        <h3>Similar news ({{ news_count }})</h3>
        {% include 'news/includes/posts.html' %}
        {% if one_more %}
          {% csrf_token %}
          <button id="load_more" class="btn btn-outline-warning">Load more</button>
        {% endif %}

       <br><br>
      </div>
{% endblock content %}

{% block side-bar %}
      <div class="side-bar">
        <div class="side-bar-header">
          <p>HOT AND TRENDING</p>
        </div>
        <div class="side-bar-header">
          <p>HOT AND TRENDING</p>
        </div>
        <div class="side-bar-header">
          <p>HOT AND TRENDING</p>
        </div>
        <div class="side-bar-header">
          <p>HOT AND TRENDING</p>
        </div>
        <div class="side-bar-header">
          <p>HOT AND TRENDING</p>
        </div>
        <div class="side-bar-header">
          <p>HOT AND TRENDING</p>
        </div>




      </div>
{% endblock side-bar %}


{% block extra_js %}
<script type="text/javascript">

    var csrftoken = getCookie('csrftoken');

    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });

    var processing;

    $(document).ready(function(){

        $(document).scroll(function(e){

            if (processing)
                return false;

            var url = "{% url 'api_news_more' %}";
            var current_news = $('div[id^="post-"]').last().attr('id').split('-')[1];
            var data = {
                'category': '{{ object.category.slug }}',
                'current_news': current_news,
            };

            if ($(window).scrollTop() >= ($(document).height() - $(window).height()) * 0.7){
                processing = true;
                $.post(
                    url, data, function (resp) {
                        $('#load_more').before(resp.html);
                        if (!resp.one_more) {
                            $('#load_more').hide();
                        }
                        processing = false;
                    }
                )
            }
        });
    });

</script>
<script type="text/javascript">
  $(".side-bar").stick_in_parent();
</script>
{% endblock %}
